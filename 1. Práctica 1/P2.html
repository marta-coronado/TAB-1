<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Current Topics in Bioinformatics" />

<meta name="date" content="2019-11-13" />

<title>P2 | Data exploration and visualization First steps with ggplot2</title>

<script src="P2_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="P2_files/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="P2_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="P2_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="P2_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="P2_files/navigation-1.1/tabsets.js"></script>
<link href="P2_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="P2_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="https:\\cdnjs.cloudflare.com\ajax\libs\font-awesome\5.11.2\css\all.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore"><strong>P2 | Data exploration and visualization</strong><br><font color='#A8A8A8' size='5'>First steps with <code>ggplot2</code></font></h1>
<h4 class="author">Current Topics in Bioinformatics</h4>
<h4 class="date">13 November 2019</h4>

</div>


<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
<div id="introduction" class="section level2">
<h2>1. Introduction</h2>
<p><strong>Data visualization</strong> refers to the techniques used to communicate data or information by encoding it as visual objects (e.g., points, lines or bars) contained in <strong>graphics</strong>. According to <a href="https://www.smashingmagazine.com/2008/01/monday-inspiration-data-visualization-and-infographics/">Friedman (2008)</a> the main goal of data visualization is to <strong>communicate information clearly</strong> and <strong>effectively</strong> through graphical means.</p>
<p>According to Friedman, that does not mean that data visualization needs to look <strong><em>boring</em></strong> to be functional or extremely sophisticated to look <strong><em>beautiful</em></strong>. To convey ideas effectively, both aesthetic form and functionality need to go hand in hand. However, designers often fail to achieve a balance between form and function, creating gorgeous data visualizations which fail to serve their main purpose, communicate information (<a href="https://www.smashingmagazine.com/2008/01/monday-inspiration-data-visualization-and-infographics/">Friedman 2008</a>).</p>
<div style="background-color:#FFDAA1">
<p><i class="fa fa-key"></i> <strong>Key concept</strong><br> Graphs are a great tool to explore the data and they are essential for presenting results. Their main goal is to communicate information clearly and efficiently to users. It is one of the steps in data analysis or data science.</p>
</div>
<p>Each new visualization can give us <strong>insights</strong> about our data. Some of this <strong>revealing information</strong> may already be known (but perhaps not yet demonstrated), while other aspects may be completely new to us. The figure below represents the process of searching new perceptions in the data (<a href="https://interactivos.lanacion.com.ar/manual-data/entender_los_datos_7.html">Aisch 2019</a>).</p>
<center>
<img src="https://bioinformatica.uab.cat/base/continguts/documents/documents.asp?link=documents\sgbcursos\documents\dataviz2019_11_4D10_30_45.png" width=40%>
</center>
<div id="p2-learning-outcomes" class="section level4">
<h4>P2 Learning outcomes</h4>
<ul>
<li>Learn the grammar of graphics of <code>ggplot2</code></li>
<li>Create the most common bioinformatics graphs (scatter plots, line plots, bar plots, …)</li>
<li>Distinguish graphic quality indicators</li>
<li>Integrity</li>
<li>Chartjunk</li>
<li>Data-ink ratio</li>
<li>Learn the characteristics of effective graphic displays</li>
</ul>
</div>
<div id="practicals-organization" class="section level3">
<h3>1.1 Practicals organization</h3>
<p>In this practical, we are going to use the <a href="https://rstudio.com/"><strong>RStudio</strong></a> integrated development environment (IDE) for R. R is a programming language for statistical computing and graphics.</p>
<center>
<img src="https://d33wubrfki0l68.cloudfront.net/26639e1fec7fa314b8fe521d1e8f97de10ff12a8/66448/images/bandtwo2.png" width=80%>
</center>
<p>The current document in which we are working is an <strong>R Markdown</strong> doccument. Similar to a Jupyter Notebook, R Markdown documents are fully reproducible and allow you to combine text, images and code –this time, R programming language.</p>
<p>To <strong>render</strong> a R Markdown document to a HTML file, you just need to click the <code>Knit</code> button that you’ll see in the RStudio bar. This HTML file can be shared as a report.</p>
<p>You don’t need to render the whole document everytime you want to see the result of your R code. You can click in the <code>Run current chunk button</code> or use the keyboard shortcut <code>Ctrl</code>+<code>Alt</code>+<code>C</code> and the result of the code will appear below it.</p>
<center>
<img src="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/chunk2019_11_6D9_14_8.png" width=60%>
</center>
<p>You will see different icons through the document, the meaning of which is:</p>
<p><i class="fas fa-info-circle"></i>: additional or useful information<br> <i class="fas fa-search"></i>: a worked example<br> <i class="fa fa-cogs"></i>: a practical exercise<br> <i class="fas fa-comment-dots"></i>: a space to answer the exercise<br> <i class="fa fa-key"></i>: a hint to solve an exercise<br> <i class="fa fa-rocket"></i>: a more challenging exercise<br><br></p>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
</div>
</div>
<div id="tools-installation" class="section level1">
<h1>2. Tools installation</h1>
<p>We strongly recommend using a <strong>Linux</strong> operating system and get used to work with the <strong>terminal</strong>. In this practical though, we won’t use it and there’s almost no difference in using Windows RStudio or Linux RStudio.</p>
<div id="installing-r" class="section level2">
<h2>2.1 Installing R</h2>
<p>R programming language can be downloaded from <a href="https://cran.rediris.es/">here</a>, and is available for Windows, Linux and macOS.</p>
</div>
<div id="installing-rstudio" class="section level2">
<h2>2.2 Installing RStudio</h2>
<p>RStudio is available to download from <a href="https://rstudio.com/products/rstudio/download/?utm_source=downloadrstudio&amp;utm_medium=Site&amp;utm_campaign=home-hero-cta">here</a>. You can easily install it in Windows, Linux and macOS.</p>
</div>
<div id="installing-a-package" class="section level2">
<h2>2.3 Installing a package</h2>
<p>R packages are collections of functions and/or data developed by the community.</p>
<p>To install a package, we use the <code>install.packages()</code> function, indicating between quotes the name of the package we want to install.</p>
<div id="installing-ggplot2" class="section level3">
<h3>2.3.1 Installing <code>ggplot2</code></h3>
<p><code>ggplot2</code> is a data visualization package for the statistical programming language R (<a href="https://www.springer.com/gp/book/9780387981413">Wickham 2009</a>). It was created by Hadley Wickham, implementing Leland Wilkinson’s Grammar of Graphics —a general scheme for data visualization which breaks up graphs into semantic components (<a href="https://onlinelibrary.wiley.com/doi/full/10.1002/wics.118">Wilkinson 2010</a>).</p>
<p>To install the <code>ggplot2</code> package, use the following:</p>
<blockquote>
<p><code>install.packages(&quot;ggplot2&quot;)</code></p>
</blockquote>
</div>
</div>
<div id="loading-a-package" class="section level2">
<h2>2.4 Loading a package</h2>
<p>To load a package, we use the function <code>library()</code>, indicating the name of the library we want to load.</p>
<p>In the case of <code>ggplot2</code>, you’ll use:</p>
<blockquote>
<p><code>library(&quot;ggplot2&quot;)</code></p>
</blockquote>
<p>You’re ready to start creating graphs!</p>
<p><img src="P2_files/figure-html/example-1.png" width="576" style="display: block; margin: auto;" /></p>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
</div>
</div>
<div id="quick-introduction-to-r" class="section level1">
<h1>3. Quick introduction to R</h1>
<div id="loading-data" class="section level2">
<h2>3.1 Loading data</h2>
<p>To <strong>load data from a delimited text file</strong>, we normally use the <code>read.table()</code> function, indicating the name of the file we want to load (including the directory if the file is not located in the same working directory as the R session). Furthermore, we can specify if the file has a header with <code>header = TRUE</code> (by default <code>FALSE</code>) or the file delimiter with <code>sep =</code> (by default <code>sep = &quot;\t&quot;</code>).</p>
<p>For example, for loading the content of <code>data.txt</code> file, which has a header and it’s a tab-delimited file, we will write:</p>
<blockquote>
<p><code>data &lt;- read.table(&quot;data.txt&quot;, header = TRUE, sep = &quot;\t&quot;)</code></p>
</blockquote>
<p>Also, the <code>read.csv()</code> function allows opening files with a <code>.csv</code> format (comma-separated values data) and the <code>read.xlsx()</code> function of the <code>xlsx</code> package allows opening Microsoft Excel files.</p>
</div>
<div id="data-formats" class="section level2">
<h2>3.2 Data formats</h2>
<p>In R, the most <strong>common data types</strong> are:</p>
<ul>
<li><strong>Logical</strong>: logical values can take on one of two values: <code>TRUE</code>, T or <code>FALSE</code>, F</li>
<li><strong>Numeric</strong>: consists of numbers such as integers (e.g. <code>1</code>, <code>-3</code>) or doubles (e.g. <code>0.5</code>, <code>-12.3</code>)</li>
<li><strong>Integer</strong>: integer numbers, such as <code>2L</code> (the <code>L</code> tells R to store this as an integer)</li>
<li><strong>Character</strong>: consist of numbers, letters or words delimited with quotes (e.g. <code>&quot;AGT&quot;</code>, <code>&quot;2&quot;</code>)</li>
</ul>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> To know the data type, you can use the <code>class()</code> function.</p>
</div>
<pre class="r"><code>type_list &lt;- list(TRUE, 1.2, 10L, &quot;a&quot;)
sapply(type_list, class)</code></pre>
<pre><code>## [1] &quot;logical&quot;   &quot;numeric&quot;   &quot;integer&quot;   &quot;character&quot;</code></pre>
<p>Elements of the previous data types may be combined to form <strong>data structures</strong>. The main data structures are:</p>
<ul>
<li><strong>Vector</strong>: consists of an ordered set of values of the same type and/or class (e.g. numeric, character, date, etc.).</li>
</ul>
<pre class="r"><code># A vector x of mode numeric
x &lt;- c(1, 2, 3)

# A vector y of mode logical
y &lt;- c(TRUE, TRUE, FALSE, FALSE)

# A vector z of mode character
z &lt;- c(&quot;Sarah&quot;, &quot;Tracy&quot;, &quot;Jon&quot;)</code></pre>
<ul>
<li><strong>Matrices</strong>: vectors indexed using two indices instead of one.</li>
</ul>
<pre class="r"><code># A 2 x 2 matrix
matrix22 &lt;- matrix(
  c(1, 2, 3, 4),
  nrow = 2,
  ncol = 2)</code></pre>
<ul>
<li><strong>Factors</strong>: a collection of values that all come from a fixed set of possible values. A factor is similar to a vector, except that the values within a factor are limited to a fixed set of possible values.</li>
</ul>
<pre class="r"><code># A vector containing &quot;dna&quot; and &quot;rna&quot;
factor_vector &lt;- as.factor(c(&quot;rna&quot;, &quot;dna&quot;, &quot;dna&quot;, &quot;rna&quot;))
str(factor_vector)</code></pre>
<pre><code>##  Factor w/ 2 levels &quot;dna&quot;,&quot;rna&quot;: 2 1 1 2</code></pre>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> <strong>Remember to always transform categorical variables to a factor</strong>. You can have a categorical variable as characters, like the previous example (“<code>dna</code>” and “<code>rna</code>”) but also as numerical values (you can have groups “<code>1</code>”, “<code>2</code>” and “<code>3</code>”). In this case you need to tell R to use numerical values as a factor, transforming them using the <code>as.factor()</code> function.</p>
</div>
<ul>
<li><strong>Lists</strong>: a collection of data structures. The components of a list can be of any structure.</li>
</ul>
<pre class="r"><code># A list
x &lt;- list(1, &quot;a&quot;, TRUE, 1+4i)</code></pre>
<ul>
<li><strong>Data.Frame</strong>: a collection of vectors that all have the same length. This is like a matrix, except that each column can contain a different data type. The attributes of an object provide specific information about the object itself.</li>
</ul>
<pre class="r"><code># A dataframe
dat &lt;- data.frame(id = letters[1:10], x = 1:10, y = 11:20)</code></pre>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
</div>
</div>
<div id="data-visualization-theory" class="section level1">
<h1>4. Data visualization theory</h1>
<p>There is grounded theory about data visualization (<a href="https://tereom.github.io/est-computacional-2018/">Ortiz 2014</a>). This section highlights the pioneering contribution of the work of <strong>Edward Tufte</strong> (1942–), American statistician and professor emeritus of political science, statistics, and computer science at Yale University. One of the central ideas of Tufte’s work refers to the <strong>removal of non-useful elements</strong> in the graphics, as they distract attention from the explanatory elements. He coined the word <strong>chartjunk</strong> to refer to this useless, non-informative, or information-obscuring elements (<a href="http://openaccess.uoc.edu/webapps/o2/handle/10609/57624">Minguillon 2016</a>). In contrast, the concept of <strong>excellence</strong> was defined as the <strong>communication of complex ideas with clarity, precision and efficiency</strong> (<a href="http://openaccess.uoc.edu/webapps/o2/handle/10609/57624">Minguillon 2016</a>).</p>
</div>
<div id="graphic-quality-indicators" class="section level1">
<h1>4.1 Graphic quality indicators</h1>
<p>Applicable to any graphic. These are concrete and relatively objective guides to assess the quality of a graph (<a href="https://www.edwardtufte.com/tufte/books_vdqi">Tufte, 2001</a>).</p>
<div style="background-color:#FFDAA1">
<ul>
<li><strong>Graphical integrity</strong>: refers to how accurately the visual elements represent the data. The lie factor, how much a graphic deviates from the actual data, should be minimized.</li>
<li><strong>Chartjunk</strong>: minimize the use of graphic decoration that interferes with the interpretation of the data: 3D effect, patterns…</li>
<li><strong>Data-ink ratio</strong>: maximize the data ink vs. total ink used to print the graphic.</li>
</ul>
</div>
</div>
<div id="lie-factor-chartjunk-and-pies" class="section level1">
<h1>4.1.1 Lie factor, chartjunk and pies</h1>
<center>
<img style="padding: 0 15px; float: right;" src="https://bioinformatica.uab.cat/base/continguts/documents/documents.asp?link=documents\sgbcursos\documents\pies2019_11_4D11_52_30.jpg" width=25%>
</center>
<p>The <strong>lie factor</strong> is the ratio of the size of an effect shown in the graphic to the size of the effect in the data. Ideally, the lie factor should be 1 (no distortion).</p>
<p>A <strong>chartjunk</strong> is an unnecessary or confusing visual element in graphs and are not necessary to comprehend the information represented on the graph or distract the the viewer from this information.</p>
<p>A popular design that qualifies as chartjunk and introduce lie factors is the <strong>3D pie</strong>. In the figure, we can see how segment C looks bigger than B, although is not the case (lie factor). The reason is the variation in the perspective that does not correspond to variation in the data (chartjunk).</p>
<p>If we correct by removing the 3D effect, the lie factor is reduced, but there are still elements that can improve the understanding of the graph: the relation between the colour, the quantification and the category. We can add tags as shown in the series on the right, but then: why not simply show the data in a table? What does the pie graph add to the interpretation? This could be more difficult if, for example, more categories are added.</p>
</div>
<div id="data-ink-ratio" class="section level1">
<h1>4.1.2 Data-ink ratio</h1>
<p>Maximizing the proportion of <strong>data-ink</strong> in our graphs has immediate benefits. The rule is: <strong>if there is ink that does not represent variation in the data, or the removal of that ink does not represent loss of meaning, that ink must be removed</strong>.</p>
<p><span class="math display">\[ Data-ink\;ratio\;=\;\frac{Data-ink}{Total\;ink\;used\;to\;print\;the\;graphic}  \]</span> According to the Tufte principle, the data must be displayed above all, so that everything that does not provide information, must be deleted (including background color, borders, grids, …).</p>
<center>
<img src="https://bioinformatica.uab.cat/base/continguts/documents/documents.asp?link=documents\sgbcursos\documents\data2ink2019_11_4D11_52_18.jpg
" width=80%>
</center>
</div>
<div id="characteristics-of-effective-graphic-displays" class="section level1">
<h1>4.2 Characteristics of effective graphic displays</h1>
<p>As we have previously introduced, Tufte defined the term excellence in data visualization as communicating complex ideas with clarity, precision and efficiency. A good visualization should:</p>
<ul>
<li>Show the data</li>
<li>Induce the viewer to think about the substance rather than about methodology, graphic design, the technology of graphic production or something else</li>
<li>Avoid distorting what the data has to say (use fair axis, avoid using more than one <code>y</code>axis)</li>
<li>Present many numbers in a small space</li>
<li>Make large data sets coherent</li>
<li>Encourage the eye to compare different pieces of data</li>
<li>Reveal the data at several levels of detail, from a broad overview to the fine structure</li>
<li>Serve a reasonably clear purpose: description, exploration, tabulation or decoration</li>
<li>Be closely integrated with the statistical and verbal descriptions of a data set</li>
</ul>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
</div>
<div id="the-grammar-of-graphics" class="section level1">
<h1>5. The grammar of graphics</h1>
<p>In a natural language, there are a series of rules that organize words into sentences, the grammar. <a href="https://www.springer.com/gp/book/9780387245447">Wilkinson (2005)</a>, created a grammar of graphics which offers us the basic elements to create them.</p>
<p>The <strong>components</strong> (or layers) of the grammar of graphics are:</p>
<ul>
<li>The <strong>data</strong> that you want to visualize</li>
<li>A set of <strong>aesthetic mappings</strong> (<code>aes</code>) describing how variables in the data are mapped to aesthetic attributes that you can perceive</li>
<li>The <strong>scales</strong> map values in the data space to values in an aesthetic space, whether it be colour, or size, or shape. Scales draw a legend or axes, which provide and inverse mapping to make it possible to read the original data values from the graph</li>
<li><strong>Statistical transformations</strong> (<code>stat</code>), summarise data in many useful ways. For example, binning and counting observations to create a histogram, or summarising a 2d relationship with a linear model</li>
<li><strong>Geometric objects</strong> (<code>geom</code>) represent what you actually see on the plot: points, lines, polygons, etc.</li>
<li>A <strong>coordinate system</strong> (<code>coord</code>) describes how data coordinates aremapped to the plane of the graphic. It also provides axes and grid lines to make it possible to read the graph. We normally use a Cartesian coordinate system, but a number of others are available, including polar coordinates and map projections</li>
<li>A <strong>faceting</strong> describes how to break up the data into subsets and how to display those subsets as small multiples</li>
</ul>
<center>
<img src="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/ggplot2layers2019_8_10D11_28_23.png" width=80%>
</center>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
</div>
<div id="first-steps-with-ggplot2" class="section level1">
<h1>6. First steps with <code>ggplot2</code></h1>
<p>The following examples will walk you through the basic components of the <code>ggplot2</code> grammar. The examples use data from the <code>datasets</code> package, which is already loaded by default in the <code>R</code> session, as well as some data sets loaded with <code>ggplot2</code> package. <code>ggplot2</code> requires data to be stored in <strong>data frames</strong> and in a <strong>long format</strong> (one observation per row and one variable per column):</p>
<pre class="r"><code>head(iris)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<pre class="r"><code>class(iris)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<hr />
<div id="example-1-creating-a-scatter-plot" class="section level2">
<h2><strong><i class="fas fa-search"></i> Example 1</strong> | Creating a scatter plot</h2>
<div id="a-basic-scatter-plot" class="section level3">
<h3><strong>1a</strong> | Basic scatter plot</h3>
<p>For the first problem we want to represent the <strong>relationship</strong> between the variables <code>Sepal.Width</code> and <code>Sepal.Length</code> from the <code>iris</code> data frame. This data frame a collection of data that quantifies the morphologic variation of <strong>iris flowers</strong> of three related species (setosa, versicolor and virginica).</p>
<center>
<img src="https://thegoodpython.com/assets/images/iris-species.png" width=80%>
</center>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> This famous (Fisher’s or Anderson’s) <code>iris</code> data set gives the measurements in centimeters of the variables sepal length and width and petal length and width, respectively, for 50 flowers from each of 3 species of iris. You can type <code>??iris</code> in the <code>R</code> console to read a description of the data.</p>
</div>
<p>To represent any graph in <code>ggplot2</code> we need two basic functions that are combined with a <code>+</code> sign:</p>
<pre class="r"><code>ggplot(data = iris, mapping = aes(x = Sepal.Width, y = Sepal.Length)) +
  geom_point()</code></pre>
<p><img src="P2_files/figure-html/scatter-ggplot2-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The variables that we want to represent are wrapped within an <code>aes()</code> function, that specifies the <strong><em>mapping</em></strong> between the variables and the <strong><em>aesthetic attributes</em></strong> (in this case we map them to spatial positions, <code>x</code> and <code>y</code>). We call the variables directly by their names, because we also pass the entire data frame to the call with the data argument, so <code>ggplot</code> knows were to get them from. Finally, we need to add the <strong><em>geometric object</em></strong> we want to represent. In this case, points.</p>
</div>
<div id="b-represent-extra-variables" class="section level3">
<h3><strong>1b</strong> | Represent extra variables</h3>
<p>Another variable in the data indicates the species (<code>Species</code>) it was measured. There are three species: setosa, versicolor and virginica.</p>
<pre class="r"><code>table(iris$Species)</code></pre>
<pre><code>## 
##     setosa versicolor  virginica 
##         50         50         50</code></pre>
<p>Let’s say we want to represent the different types of species in different colours. In this case we want to use <code>Species</code> as a <strong>categorical variable</strong>, i.e., as a factor. By default, this variable is already a factor:</p>
<pre class="r"><code>class(iris$Species)</code></pre>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>We use <code>Species</code> in the <code>colour</code> aesthetic:</p>
<pre class="r"><code>ggplot(data = iris, mapping = aes(x = Sepal.Width, y = Sepal.Length, colour = Species)) +
  geom_point()</code></pre>
<p><img src="P2_files/figure-html/groups-ggplot2-1.png" width="576" style="display: block; margin: auto;" /></p>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> Note that <code>ggplot</code> adds a <strong>legend</strong> by default for all the variables that have been mapped to some aesthetic attribute. This way we can read all the variables without extra effort.</p>
</div>
</div>
<div id="exercise" class="section level3">
<h3><i class="fa fa-cogs"></i> Exercise</h3>
<p>Try mapping <code>Species</code> to another aesthetic attribute instead of <code>colour</code>, such as <code>shape</code>, <code>size</code>, <code>alpha</code>. Are you getting any warning message? Why?</p>
<div style="background-color:#F0F0F0">
<h5 id="answer"><i class="fas fa-comment-dots"></i> Answer:</h5>
<pre class="r"><code>ggplot(data = iris, mapping = aes(x = Sepal.Width, y = Sepal.Length, shape = Species)) +
  geom_point()</code></pre>
<p><img src="P2_files/figure-html/answer1.1-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<hr />
</div>
</div>
<div id="example-2-creating-a-bar-plot" class="section level2">
<h2><i class="fas fa-search"></i> <strong>Example 2</strong> | Creating a bar plot</h2>
<p>For this second exercise we are going to use <code>mtcars</code> dataset, which contain information about the <strong>fuel consumption and 10 aspects of automobile design and performance for 32 automobiles</strong>.</p>
<pre class="r"><code>head(mtcars)</code></pre>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<pre class="r"><code>class(mtcars)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models). You can type <code>??mtcars</code> in the <code>R</code> console to read a description of the data.</p>
</div>
<p>One of the variables of interests in the data indicates the number of cylinders of the car engines (<code>cyl</code>). There are cars with 4, 6 or 8 cylinders.</p>
<div id="a-basic-bar-plot" class="section level3">
<h3><strong>2a</strong> | Basic bar plot</h3>
<p>We want to summarise this data in a simple <strong>bar plot</strong> representing the number of cars in each cylinder category; i.e., how many cars have 4, 6 or 8 cylinders. However, the number of cars with 4 cylinders is not a piece of information present in the data set, for example. To know the number it is necessary to count the rows where <code>cyl = 4</code>, and we are not going to do it <i class="fas fa-smile-wink"></i>.</p>
<p><code>ggplot2</code> is capable to do simple summary operations with the input variables, refered as <strong><strong>statistical tranformations</strong></strong>. One of them is to count the occurrences of each value in a variable, which is precisely what we want to do. And <code>geom_bar</code> function happen to use the <code>count</code> statistical transformation by default on the variable mapped to the <code>x</code> axis.</p>
<p>The first thing that we are going to do is to check the class of the <code>cyl</code> variable:</p>
<pre class="r"><code># First we check the class of cyl
class(mtcars$cyl)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>We see that it’s a numeric variable. In this case we want to use <code>cyl</code> as a categorical variable, distinguishing groups rather than indicating a value in a numerical continuous scale. For that, we need to change its class before giving it to <code>ggplot</code> using the <code>as.factor()</code> function.</p>
<pre class="r"><code># We create a new variable in the dataframe, cyl_f, that is cyl converted to factor
mtcars$cyl_f &lt;- as.factor(mtcars$cyl)</code></pre>
<p>Now we can create the bar plot:</p>
<pre class="r"><code>ggplot(data = mtcars, mapping = aes(x = cyl_f)) +
  geom_bar()</code></pre>
<p><img src="P2_files/figure-html/barplot-ggplot2-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Imagine that we have already a table with the number of cars with each cylinder category. If we had a precomputed data frame with <code>cyl</code> and <code>number_of_cars</code> instead, we could pass <code>number_of_cars</code> variable to <code>geom_col</code> function instead of <code>geom_bar</code>, that by default takes the variables mapped to <code>x</code> and <code>y</code> without transformation.</p>
<pre class="r"><code># Let&#39;s create the data frame
counts_by_cyl_data_frame &lt;- as.data.frame(table(mtcars$cyl))
names(counts_by_cyl_data_frame) &lt;- c(&quot;cyl&quot;, &quot;number_of_cars&quot;)

counts_by_cyl_data_frame</code></pre>
<pre><code>##   cyl number_of_cars
## 1   4             11
## 2   6              7
## 3   8             14</code></pre>
<pre class="r"><code>ggplot(data = counts_by_cyl_data_frame, mapping = aes(x = cyl, y = number_of_cars)) +
  geom_col()</code></pre>
<p><img src="P2_files/figure-html/barplot-table-1.png" width="576" style="display: block; margin: auto;" /></p>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-hand-point-up"></i> We’ll use <code>geom_bar</code> if the dataset is not processed and we need to count the ocurrences of a category. If we have a processed dataset with the counts, we’ll use <code>geom_col</code>.</p>
</div>
</div>
<div id="b-groups-and-position" class="section level3">
<h3><strong>2b</strong> | Groups and position</h3>
<p>We have seen in the scatter plot example how to represent groups encoded in extra variables as colours. Say we now want to show transmission type (<code>am</code>) in the bar plot, in addition to the number of cylinders. We can map <code>am</code> to the filling colour of the bars, <code>fill</code> (<code>colour</code> aesthetic would change the edges of the rectangles). There are two types of transmission: <code>0</code> for automatic cars and <code>1</code> for manual cars.</p>
<pre class="r"><code># First we check the class of the variable
class(mtcars$am)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<pre class="r"><code># We make am factor, and we can change the 0/1 notation for a more informative notation: automatic/manual
mtcars$am_f &lt;- factor(mtcars$am, levels = c(0, 1), labels = c(&quot;automatic&quot;, &quot;manual&quot;))

# Plot
ggplot(data = mtcars, mapping = aes(x = cyl_f, fill = am_f)) +
  geom_bar()</code></pre>
<p><img src="P2_files/figure-html/groups-bar-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Each geometric object in <code>ggplot2</code> also has a <strong><strong>position</strong></strong> argument that controls how groups are arranged. In <code>geom_bar</code> the default position is to stack the groups. We can change it for a side-by-side position with <code>position = &quot;dodge&quot;</code>.</p>
<pre class="r"><code>ggplot(data = mtcars, mapping = aes(x = cyl_f, fill = am_f)) +
  geom_bar(position = &quot;dodge&quot;)</code></pre>
<p><img src="P2_files/figure-html/position-bar-ggplot2-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-1" class="section level3">
<h3><i class="fa fa-cogs"></i> Exercise</h3>
<p>Update the plot above with the <code>&quot;fill&quot;</code> position adjustment instead of <code>&quot;dodge&quot;</code>. What it is doing?</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-1"><i class="fas fa-comment-dots"></i> Answer:</h5>
<p>It fills the whole column, showing only information about the proportions.</p>
</div>
<pre class="r"><code>ggplot(data = mtcars, mapping = aes(x = cyl_f, fill = am_f)) +
  geom_bar(position = &quot;fill&quot;)</code></pre>
<p><img src="P2_files/figure-html/qwanswer2.1-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Update the previous plot to group by the variable <code>gear</code> instead of the transmission type (<code>am_f</code>). <code>gear</code> variable is the number of forward gear: cars can have 3, 4 and 5 gears. Check if you need to transform <code>gear</code> to a factor.</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-2"><i class="fas fa-comment-dots"></i> Answer:</h5>
<pre class="r"><code>ggplot(data = mtcars, mapping = aes(x = cyl_f, fill = gear)) +
  geom_bar(position = &quot;fill&quot;)</code></pre>
<p><img src="P2_files/figure-html/qanswer2.2-1.png" width="576" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(data = mtcars, mapping = aes(x = cyl_f, fill = as.factor(gear))) +
  geom_bar(position = &quot;fill&quot;)</code></pre>
<p><img src="P2_files/figure-html/qanswer2.2-2.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<hr />
</div>
</div>
<div id="example-3-showing-the-distribution-of-a-variable" class="section level2">
<h2><i class="fas fa-search"></i> <strong>Example 3</strong> | Showing the distribution of a variable</h2>
<div id="a-simple-histogram" class="section level3">
<h3><strong>3a</strong> | Simple histogram</h3>
<p>Now we have a new data set called <code>diamonds</code> and we need to understand the distribution of some of its continuous variables. A good place to start is a histogram, that represents the number of observations in different ranges as bars.</p>
<pre class="r"><code>head(diamonds)</code></pre>
<pre><code>## # A tibble: 6 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.23  Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
## 2 0.21  Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
## 3 0.23  Good      E     VS1      56.9    65   327  4.05  4.07  2.31
## 4 0.290 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
## 5 0.31  Good      J     SI2      63.3    58   335  4.34  4.35  2.75
## 6 0.24  Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48</code></pre>
<pre class="r"><code>class(diamonds)</code></pre>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> <code>diamonds</code> is a dataset containing the prices and other attributes of almost 54,000 diamonds. You can type <code>??diamonds</code> in the <code>R</code> console to read a description of the data.</p>
</div>
<p>The function that we need is called <code>geom_histogram()</code> and has the statistical transformation <code>bin</code> by default. In this case, <code>bin</code> divides the variable mapped to <code>x</code> in ranges and counts the number of values in each bin. The number of bins is controlled with the argument <code>binwidth</code>. In this example we show the distribution of the weights of diamonds (<code>carat</code>).</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat)) +
  geom_histogram(binwidth = 0.3)</code></pre>
<p><img src="P2_files/figure-html/histogram-1.png" width="576" style="display: block; margin: auto;" /></p>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> Note that histograms deal with <em>continuous</em> variables while bar plots with <em>discrete</em>, but are sometimes <a href="https://www.google.com/search?q=histograms+and+bar+graphs+difference">confused</a>.</p>
</div>
</div>
<div id="b-multiple-histograms" class="section level3">
<h3><strong>3b</strong> | Multiple histograms</h3>
<p>The <code>diamonds</code> dataset contains more information about diamonds, such as the quality (<code>cut</code>) or the color (<code>color</code>). To see the distribution of the weight we can try to map it to the filling <code>cut</code>:</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(binwidth = 0.3) </code></pre>
<p><img src="P2_files/figure-html/histogram-fill-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Stacked histograms are difficult to interpret. We can use another position instead of the default “<code>stacked</code>” position. For example, using <code>position = &quot;dodge&quot;</code>.</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3)</code></pre>
<p><img src="P2_files/figure-html/histogram%20dodge-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>But there’s even a better option. <code>ggplot2</code> provides a simple way of creating small multiples or <strong>facets</strong> with the function <code>facet_grid</code>:</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .)</code></pre>
<p><img src="P2_files/figure-html/facets-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-2" class="section level3">
<h3><i class="fa fa-cogs"></i> Exercise</h3>
<p>What happens if you change the order of the <code>facet_grid</code> elements, i.e., <code>(. ~ cut)</code>?</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-3"><i class="fas fa-comment-dots"></i> Answer:</h5>
<p>Los histogramas se muestran adosados horizontalmente:</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(. ~ cut)</code></pre>
<p><img src="P2_files/figure-html/diamonds-facetsanswer3.1-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<p>Which is the best subplot configuration to compare the distributions and why?</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-4"><i class="fas fa-comment-dots"></i> Answer:</h5>
<p>El apilamiento vertical muestra de forma mas clara las diferencias en la variable de interes, en este caso ‘carat’.</p>
</div>
<hr />
</div>
</div>
<div id="example-4-customizing-a-plot" class="section level2">
<h2><i class="fas fa-search"></i> <strong>Example 4</strong> | Customizing a plot</h2>
<div id="a-modify-colours" class="section level3">
<h3><strong>4a</strong> | Modify colours</h3>
<p>So far we have used the <strong>default colour palettes</strong> for all our representations. We may need to change them to make them accessible to <strong>colourblind people</strong>, match the colour palette of our project or give <strong>meaningful values</strong> (e.g., red for positive and blue for negative). We can control the exact mapping of a variable to an aesthetic attribute with the functions <code>scale_*</code>.</p>
<p>In the following example we manually set the color of the five type of diamond qualities. You can use other color names checking the following <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">R color guide</a>.</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .) +
  scale_fill_manual(values = c(&quot;sienna1&quot;, &quot;orange&quot;, &quot;lightseagreen&quot;, &quot;orangered&quot;, &quot;red4&quot;))</code></pre>
<p><img src="P2_files/figure-html/change-col-ggplot2-1.png" width="576" style="display: block; margin: auto;" /></p>
<div style="background-color:#FFDAA1">
<p><i class="fas fa-info-circle"></i> Note that scale functions update both the aesthetic mappings in the plot and in the legend.</p>
</div>
</div>
<div id="b-change-or-add-axis-legend-and-plot-titles" class="section level3">
<h3><strong>4b</strong> | Change (or add) axis, legend and plot titles</h3>
<p>We may also need to add a <strong>title</strong> to the plot or change the <strong>axis titles</strong>. There are several options for that: * In <code>ggplot2</code>, axis and legend titles can be specified with <code>name</code> argument within a <code>scale_*</code> function * The title can be changed with <code>+ ggtitle(&quot;Title name&quot;)</code> * You can also use the convenience function <code>labs()</code>, with <code>fill = &quot;&quot;</code> you will set a new legend title and <code>title = &quot;&quot;</code> a new title. See the working example:</p>
<pre class="r"><code># We save the common part of the plot in a variable and then we can add more components with the &quot;+&quot; sign
p &lt;- ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .)
  
# Option A:
p + scale_fill_manual(values = c(&quot;sienna1&quot;, &quot;orange&quot;, &quot;lightseagreen&quot;, &quot;orangered&quot;, &quot;red4&quot;), name = &quot;Quality&quot;) +
  scale_x_continuous(name = &quot;Weight of the diamond&quot;) + 
  ggtitle(&quot;Diamond weight variation&quot;)</code></pre>
<p><img src="P2_files/figure-html/titles-ggplot2-1.png" width="576" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Option B:
# p + scale_fill_manual(values = c(&quot;sienna1&quot;, &quot;orange&quot;, &quot;lightseagreen&quot;, &quot;orangered&quot;, &quot;red4&quot;)) +
#   labs(title = &quot;Diamond weight variation&quot;, x = &quot;Weight of the diamond&quot;, fill = &quot;Quality&quot;)</code></pre>
</div>
<div id="c-change-theme" class="section level3">
<h3><strong>4c</strong> | Change theme</h3>
<p>The appearence of <code>ggplot2</code> plots is controlled by the <strong>themes</strong>. The default <code>ggplot2</code> theme has a gray background and “<em>is designed to put the data forward yet make comparisons easy</em>”. You can change the general appearence by choosing a different theme with <code>theme_*</code> functions. There are <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">eight different themes</a> available. The following example uses the “black and white” theme (<code>theme_bw()</code>):</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .) +
  scale_fill_manual(values = c(&quot;sienna1&quot;, &quot;orange&quot;, &quot;lightseagreen&quot;, &quot;orangered&quot;, &quot;red4&quot;), name = &quot;Quality&quot;) +
  scale_x_continuous(name = &quot;Weight of the diamond&quot;) + 
  ggtitle(&quot;Diamond weight variation&quot;) +
  theme_bw()</code></pre>
<p><img src="P2_files/figure-html/theme-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-3" class="section level3">
<h3><i class="fas fa-cogs"></i> Exercise</h3>
<p>Using the following code, try other <code>scale_fill_*</code> functions in <code>ggplot2</code> with pre-defined palettes, such as <code>scale_fill_hue()</code>, <code>scale_fill_brewer()</code>, <code>scale_fill_viridis_d()</code> (default) and <code>scale_fill_grey()</code>. Which palette would you use to ensure that colourblind people can distinguish the colours, <code>scale_fill_hue()</code> or <code>scale_fill_viridis_d()</code>?</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-5"><i class="fas fa-comment-dots"></i> Answer:</h5>
<p>Utilizaria viridis.</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .) +
  scale_fill_brewer()</code></pre>
<p><img src="P2_files/figure-html/answer4.1-1.png" width="576" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .) +
  scale_fill_viridis_d()</code></pre>
<p><img src="P2_files/figure-html/answer4.1-2.png" width="576" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .) +
  scale_fill_hue()</code></pre>
<p><img src="P2_files/figure-html/answer4.1-3.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<p>Try <code>subtitle = &quot;&quot;</code>, <code>caption =&quot;&quot;</code> and <code>tag =&quot;&quot;</code> arguments from the <code>labs()</code> function. What are they for?</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-6"><i class="fas fa-comment-dots"></i> Answer:</h5>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .) +
  labs(subtitle =&quot;subtitle&quot;,caption =&quot;caption&quot;, tag =&quot;tag&quot;)</code></pre>
<p><img src="P2_files/figure-html/answer4.2-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<p>Which theme of the <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">eight availables</a> do you think that maximises the data-ink ratio?</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-7"><i class="fas fa-comment-dots"></i> Answer:</h5>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, fill = cut)) +
  geom_histogram(position = &quot;dodge&quot;, binwidth = 0.3) + 
  facet_grid(cut ~ .) # +</code></pre>
<p><img src="P2_files/figure-html/answer%204.3-1.png" width="576" style="display: block; margin: auto;" /></p>
<pre class="r"><code>  # theme_* # theme that maximises the ink-ratio</code></pre>
</div>
<hr />
</div>
</div>
<div id="saving-the-plots" class="section level2">
<h2><i class="fas fa-info-circle"></i> Saving the plots</h2>
<p>There are three ways to save a plot to a file (from easy to difficult):</p>
<p>A. Export button from <code>RStudio</code> plot panel</p>
<p>B. <code>ggsave</code> function from <code>ggplot2</code> package</p>
<pre class="r"><code>p &lt;- ggplot(data = iris, mapping = aes(x = Sepal.Width, y = Sepal.Length)) + geom_point()
ggsave(filename = &quot;plot.png&quot;, plot = p, width = 6, height = 4) # In inches by default</code></pre>
<p>C. Opening &gt; Ploting &gt; Closing a graphic device</p>
<pre class="r"><code>png(filename = &quot;plot.png&quot;, width = 600, height = 400, res = 150) # In pixels by default
p
dev.off()</code></pre>
<p>Plots can be saved using different image file formats. Option <strong>A</strong> gives you the format options in a drop list, option <strong>B</strong> guesses the format from the filename extension (e.g. <code>plot.png</code>), and in option <strong>C</strong> the function that is used to open the graphic device determines the format of the output (in the example <code>png()</code>).</p>
<p>The main formats can be classified into:</p>
<ul>
<li>Raster/bitmat formats, where information is stored in pixels and have a maximum resolution.
<ul>
<li><strong>PNG</strong>: extension .png, supports transparent background, good compression, doesn’t lose quality</li>
<li><strong>JPEG</strong>: extensions .jpg and .jpeg, very good compression, used in personal photography but suffers from quality degradation with repeated modifications</li>
<li><strong>TIFF</strong>: extensions .tif and .tiff, preferred format for professional printing</li>
</ul></li>
<li>Vector formats, where information is encoded in geometric shapes that can be rendered at any size without losing resolution.
<ul>
<li><strong>SVG</strong>: extension .svg, standard for vector graphics, requires <code>svglite</code> package</li>
</ul></li>
<li>Hybrid
<ul>
<li><strong>PDF</strong>: can contain both vector graphics and raster images</li>
</ul></li>
</ul>
<div id="exercise-4" class="section level3">
<h3><i class="fas fa-cogs"></i> Exercise</h3>
<p>Save the plot <code>p</code> in a raster and a vector format with the same size using <code>ggsave()</code> (e.g.: <code>width = 600, height = 400, res = 150</code>). What differences do you observe when you zoom in them?</p>
<p><i class="fas fa-info-circle"></i> Note: svg devices require <code>svglite</code> R package and other system libraries (<code>libcairo2-dev</code> and <code>libfontconfig1-dev</code>). Skip the exercise if you get an error!</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-8"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<hr />
</div>
</div>
<div id="wrap-up-exercise" class="section level2">
<h2><i class="fa fa-rocket"></i> Wrap up exercise</h2>
<p>If for representing a scatter plot we use <code>geom_point()</code>, a bar plot <code>geom_bar()</code> … could you guess how to represent a <strong>line</strong> plot with <code>ggplot2</code> syntax?</p>
<ul>
<li>Represent how <code>unemploy</code> variable changes over time (<code>date</code> variable) from <code>economics</code> dataset with a line plot using <code>ggplot2</code> syntax</li>
<li>Modify axis names and add a title</li>
<li>Use a theme</li>
<li>Save the plot to a file using a raster image format (png)</li>
</ul>
<div style="background-color:#F0F0F0">
<h5 id="answer-9"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p><i class="fa fa-key"></i> The final image should look like this:</p>
<center>
<img src="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/plot2019_11_5D10_50_1.png" width=50%>
</center>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
</div>
</div>
<div id="analyzing-p1-data" class="section level1">
<h1>7. Analyzing P1 data</h1>
<p>In the Practical 1 we generate several files containing interesting information… but reading numbers doesn’t look very appealing. Now that we know how to create scatter plots, bar plots and line plots… shall we try representing our data?</p>
<p>The files used in the next examples are:</p>
<ul>
<li><strong>Mapping statistics</strong> (step 7.2): <code>sorted.depth.txt.gz</code></li>
<li><strong>VCF statistics</strong> (step 8.2): substitution types (you need to manually extract this data from <code>file.vcf.gz.stats</code> file)</li>
<li><strong>Diversity statistics</strong> (step 9): <code>out.windowed.pi</code> and <code>out.snpden</code></li>
<li><strong>VEP statistics</strong> (step 10): <code>txt</code> file downloaded from the VEP web service</li>
</ul>
<hr />
<div id="graphic-1-creating-a-scatter-plot-for-the-coverage" class="section level2">
<h2><strong><i class="fas fa-pencil-alt"></i> Graphic 1</strong> | Creating a scatter plot for the coverage</h2>
<p>We generated a file from the sorted BAM file with the read depth for all positions, i.e., how many reads are overlapping the genomic position, <code>sorted.depth.txt.gz</code>, available for download <a href="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/depth2019_11_6D10_16_25.txt">here</a>.</p>
<p>We can read the file by typing:</p>
<pre class="r"><code>readDepth &lt;- read.table(&quot;https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/depth2019_11_6D10_16_25.txt&quot;, sep=&#39;\t&#39;, header=FALSE)

head(readDepth)</code></pre>
<pre><code>##   V1        V2 V3
## 1  2 134799753  1
## 2  2 134799754  1
## 3  2 134799755  1
## 4  2 134799756  1
## 5  2 134799757  1
## 6  2 134799758  1</code></pre>
<p>As we can see, this file does not have a header, but we can manually add it using:</p>
<pre class="r"><code>colnames(readDepth) &lt;- c(&quot;chr&quot;, &quot;position&quot;, &quot;depth&quot;)
head(readDepth)</code></pre>
<pre><code>##   chr  position depth
## 1   2 134799753     1
## 2   2 134799754     1
## 3   2 134799755     1
## 4   2 134799756     1
## 5   2 134799757     1
## 6   2 134799758     1</code></pre>
<div id="exercise-5" class="section level3">
<h3><i class="fas fa-cogs"></i> Exercise</h3>
<p>Modify the code to generate the figure of <code>scatter-ggplot2</code> chunk (a scatter plot) to represent in a point plot the coverage (<code>depth</code>) against the position (<code>position</code>).</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-10"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p>We can colour the points conditionally according to a coverage value, e.g.: 20. Simply add <code>color = depth &lt; 20</code> inside the <code>aes()</code> call of <code>ggplot2()</code>.</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-11"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p>With your knowledge, try to: - Change the color of the dots using <code>+ scale_colour_manual()</code> as we did in <code>change-col-ggplot2</code> chunk, coloring the dots as red and black, for example. - Use nicer labels, change the legend name, and add a title. (<i class="fa fa-key"></i>: Hint: use <code>labs(color = &quot;Legend title&quot;)</code> instead of <code>fill</code> to change the legend name) - Use a theme - Anything extra you want to try</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-12"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p><i class="fa fa-key"></i> The temptative figure should look like this:</p>
<center>
<img src = "https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/depth2019_11_5D12_2_56.png" width = 70%>
</center>
<hr />
</div>
</div>
<div id="graphic-2-creating-a-bar-plot-for-the-vcf-statistics" class="section level2">
<h2><strong><i class="fas fa-pencil-alt"></i> Graphic 2</strong> | Creating a bar plot for the VCF statistics</h2>
<p>We can extract the <strong>Substitution types</strong> from the <code>file.vcf.gz.stats</code> file:</p>
<center>
<img src = "https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/substitutions2019_11_5D12_9_36.png" width = 70%>
</center>
<p>For that, just copy the lines starting with <code>ST</code> in a new file. The sample file can be downloaded <a href="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/ST2019_11_5D12_11_13.txt">here</a>.</p>
<p><i class = "fa fa-rocket"></i> You can extract this information from the terminal by simply writing:</p>
<p><code>grep &quot;^ST&quot; file.vcf.gz.stats &gt; ST.txt</code></p>
<p>Once you have the file, we can read it on R:</p>
<pre class="r"><code>st &lt;- read.table(&quot;https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/ST2019_11_5D12_11_13.txt&quot;, sep=&#39;\t&#39;, header=FALSE)

head(st)</code></pre>
<pre><code>##   V1 V2  V3  V4
## 1 ST  0 A&gt;C  71
## 2 ST  0 A&gt;G 344
## 3 ST  0 A&gt;T  59
## 4 ST  0 C&gt;A  71
## 5 ST  0 C&gt;G  76
## 6 ST  0 C&gt;T 298</code></pre>
<p>As we can see, this file does not have a header, but we can manually add it using:</p>
<pre class="r"><code>colnames(st) &lt;- c(&quot;ST&quot;, &quot;ID&quot;, &quot;type&quot;, &quot;count&quot;)
head(st)</code></pre>
<pre><code>##   ST ID type count
## 1 ST  0  A&gt;C    71
## 2 ST  0  A&gt;G   344
## 3 ST  0  A&gt;T    59
## 4 ST  0  C&gt;A    71
## 5 ST  0  C&gt;G    76
## 6 ST  0  C&gt;T   298</code></pre>
<div id="exercise-6" class="section level3">
<h3><i class="fas fa-cogs"></i> Exercise</h3>
<p>Modify the code to generate the figure of <code>barplot-table</code> chunk (bar plot) to represent in a bar plot how many substitutions there are:</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-13"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p>Try to do the same graph but using the <strong>InDel distribution</strong> information, also available in the <code>file.vcf.gz.stats</code> file. You can download the file from <a href="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/indel2019_11_5D12_17_36.txt">here</a>.</p>
<p><i class = "fa fa-rocket"></i> You can extract this information from the terminal by simply writing:</p>
<p><code>grep &quot;^IDD&quot; file.vcf.gz.stats &gt; indel.txt</code></p>
<p>If you need to change the header, use the following vector: <code>c(&quot;IDD&quot;, &quot;ID&quot;, &quot;length&quot;, &quot;count&quot;)</code>.</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-14"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p>As before, with your knowledge, try to add any modification you consider (change the theme add a title, …)</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-15"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p><i class="fa fa-key"></i> The temptative figures should look like this:</p>
<center>
<img src = "https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/stats2019_11_5D12_27_34.png" width = 60%>
</center>
<hr />
</div>
</div>
<div id="graphic-3-creating-a-line-plot-for-the-diversity-statistics" class="section level2">
<h2><strong><i class="fas fa-pencil-alt"></i> Graphic 3</strong> | Creating a line plot for the diversity statistics</h2>
<p>Finally, we can anlyze the nucleotide diversity that is in the <code>out.windowed.pi</code> file. If you don’t have it, you can downloaded it from <a href="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/pi2019_11_5D12_35_42.txt">here</a>.</p>
<p>Once you have the file, we can read it on R:</p>
<pre class="r"><code>pi &lt;- read.table(&quot;https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/pi2019_11_5D12_35_42.txt&quot;, sep=&#39;\t&#39;, header=TRUE)

head(pi)</code></pre>
<p>In this case, the file has a header so it’s ready to be used for plotting.</p>
<div id="exercise-7" class="section level3">
<h3><i class="fas fa-cogs"></i> Exercise</h3>
<p>Modify the code to generate the figure of the Wrap up exercise, <code>wrap-exercise-line-plot</code> chunk (line plot) to represent in a line plot the nucleotide diversity (<code>PI</code>) against the position (<code>BIN_START</code>).</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-16"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p>Try to do other line plots and represent the SNP density (<code>VARIANTS/KB</code> column of <code>out.snpden</code> file) or the SNP count (<code>SNP_COUNT</code> column of <code>out.snpden</code> file). If you don’t have this file, you can download it from <a href="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/snpDensity2019_11_5D12_46_19.txt">here</a>.</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-17"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p>As before, with your knowledge, try to add any modification you consider (change the theme add a title, …)</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-18"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p><i class="fa fa-key"></i> The temptative figures should look like this:</p>
<center>
<img src = "https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/nuc2019_11_5D12_41_19.png" width = 60%>
</center>
<hr />
</div>
</div>
<div id="wrap-up-exercise-analyze-vep-data" class="section level2">
<h2><i class="fa fa-rocket"></i> Wrap up exercise: analyze VEP data</h2>
<p>Finally, with your knowledge, try to make a figure to analyze the VEP information: for example, try to do a bar plot representing the functional consequence of SNPs (<code>Consequence</code>) or the type of genomic element is affecting (<code>BIOTYPE</code>). The file can be downloaded from <a href="https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/vep2019_11_6D10_29_7.txt">here</a>.</p>
<p>Note that this file already have a header.</p>
<p><i class="fa fa-key"></i> If you need to rotate the <code>x</code>-axis labels to facilitate its reading, as in the temptative figure, check this <a href="https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2">StackOverflow post</a>.</p>
<div style="background-color:#F0F0F0">
<h5 id="answer-19"><i class="fas fa-comment-dots"></i> Answer:</h5>
</div>
<p><i class="fa fa-key"></i> A temptative figure could look like this:</p>
<center>
<img src = "https://bioinformatica.uab.cat/base/documents/sgbcursos/documents/vep2019_11_6D10_35_43.png" width = 60%>
</center>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
</div>
</div>
<div id="upload-your-results-to-your-github" class="section level1">
<h1>8. Upload your results to your GitHub</h1>
<p>Upload this Rmd document and the figures you have generated to your GitHub repository.</p>
<div style="background-color: #86CBBB; 1px; height:3px ">

</div>
<p><br></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
